<!DOCTYPE html>
<html lang="id">
<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <title>Pelite PTSP Online Kemenag Babar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'neumo-base': '#e0e5ec',
                        'primary-blue': '#2563eb',
                    },
                    boxShadow: {
                        'neumo-out': '6px 6px 12px #a3b1c6, -6px -6px 12px #ffffff',
                        'neumo-in': 'inset 6px 6px 12px #a3b1c6, inset -6px -6px 12px #ffffff',
                        'neumo-press': 'inset 3px 3px 6px #a3b1c6, inset -3px -3px 6px #ffffff',
                    },
                    fontFamily: {
                        'poppins': ['Poppins', 'sans-serif'],
                        'titillium': ['Titillium Web', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Menggunakan font Poppins yang sudah dimuat */
        html { font-family: 'Poppins', sans-serif; } 
        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-color: #e0e5ec;
            color: #4b5563;
        }

        /* Sidebar */
        .sidebar {
            transition: transform 0.3s ease-out;
            transform: translateX(100%);
            background-color: #e0e5ec;
        }
        .sidebar.open {
            transform: translateX(0);
        }

        /* Neumorphic Button */
        .neumo-btn {
            background-color: #e0e5ec;
            box-shadow: 6px 6px 12px #a3b1c6, -6px -6px 12px #ffffff;
            transition: all 0.2s ease-in-out;
        }
        .neumo-btn:active {
            box-shadow: inset 3px 3px 6px #a3b1c6, inset -3px -3px 6px #ffffff;
            color: #2563eb;
        }

        /* Tabel Style */
        .admin-table {
            background-color: #e0e5ec;
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: 6px 6px 12px #a3b1c6, -6px -6px 12px #ffffff;
        }
        .admin-table th {
            background: linear-gradient(to right, #2563eb, #1d4ed8);
            color: white;
            padding: 1rem;
        }
        .admin-table td {
            padding: 1rem;
            border-bottom: 1px solid #d1d5db;
        }
        .admin-photo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
        }
        /* Tombol 3D Kecil untuk Aksi di Tabel */
        .btn-3d-aksi {
            background-color: #2563eb; /* Warna biru */
            color: white;
            border-radius: 8px;
            border-bottom: 3px solid #1d4ed8; /* Warna lebih gelap untuk efek 3D */
            transition: all 0.1s ease-in-out;
        }
        .btn-3d-aksi:hover {
            background-color: #1d4ed8; /* Warna lebih gelap saat hover */
        }
        .btn-3d-aksi:active {
            transform: translateY(2px);
            border-bottom-width: 1px;
        }

        /* Modal Style */
        .modal-content {
            background-color: #e0e5ec;
            border-radius: 1rem;
        }
        .modal-header, .modal-footer {
            border: none;
        }
        .modal-title {
            color: #2563eb;
            font-weight: bold;
        }
        .portrait-photo {
            width: 120px;
            height: 180px;
            object-fit: cover;
            border-radius: 0.5rem;
            display: block;
            margin: 0 auto 1rem;
        }
    </style>
</head>
<body>

    <nav class="sticky top-0 z-20 bg-green-800 shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <img src="logokemenag.png" alt="Logo PTSP" class="w-8 h-8 rounded-full mr-2">
                    <span class="text-xl font-bold text-white">PTSP ONLINE KEMENTERIAN AGAMA BANGKA BARAT</span>
                </div>
                <div class="flex">
                    <button id="menu-button" class="p-2 rounded-md text-gray-200 hover:text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white" aria-label="Toggle Menu">
                        <i data-lucide="menu" class="h-6 w-6"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div id="overlay" class="fixed inset-0 bg-black opacity-0 z-20 transition-opacity duration-300 pointer-events-none"></div>

    <div id="sidebar-menu" class="sidebar fixed top-0 right-0 w-64 h-full shadow-xl z-30 flex flex-col pt-4 overflow-y-auto">
        <div class="flex justify-end p-4">
            <button id="close-menu-button" class="neumo-btn w-10 h-10 rounded-full flex items-center justify-center" aria-label="Close Menu">
                <i data-lucide="x" class="h-6 w-6 text-gray-600"></i>
            </button>
        </div>
        <a href="index.html" class="p-4 text-gray-700 hover:shadow-neumo-in font-medium border-b border-neumo-base no-underline" onclick="closeMenu()">Beranda</a>
        <a href="prosedur.html" class="p-4 text-gray-700 hover:shadow-neumo-in font-medium border-b border-neumo-base no-underline" onclick="closeMenu()">Prosedur Layanan</a> 
        <a href="layanan.html" class="p-4 text-gray-700 hover:shadow-neumo-in font-medium border-b border-neumo-base no-underline" onclick="closeMenu()">Layanan Masyarakat</a>
        <a href="#" class="p-4 text-gray-700 hover:shadow-neumo-in font-medium border-b border-neumo-base no-underline" onclick="closeMenu()">Janji Temu</a>
        <a href="#" class="p-4 text-gray-700 hover:shadow-neumo-in font-medium border-b border-neumo-base no-underline" onclick="closeMenu()">Survey Kepuasan Masyarakat</a>
        <a href="#" class="p-4 text-gray-700 hover:shadow-neumo-in font-medium border-b border-neumo-base no-underline" onclick="closeMenu()">Aplikasi Akhdan</a>
        <a href="#" class="p-4 text-gray-700 hover:shadow-neumo-in font-medium border-b border-neumo-base no-underline" onclick="closeMenu()">Hubungi Kami</a>
        <a href="#" class="p-4 text-gray-700 hover:shadow-neumo-in font-medium border-b border-neumo-base no-underline" onclick="closeMenu()">FAQ</a>
        <a href="pengaturan.html" class="p-4 text-gray-700 bg-primary-blue text-white font-medium border-b border-neumo-base no-underline" onclick="closeMenu()">Pengaturan Administrator</a>
        <a href="#" class="p-4 text-gray-700 hover:shadow-neumo-in font-medium border-b border-neumo-base no-underline" onclick="closeMenu()">Daftar Layanan</a>
        <a href="#" class="p-4 text-gray-700 hover:shadow-neumo-in font-medium border-b border-neumo-base no-underline" onclick="closeMenu()">Backup Data & Reset</a>
    </div>

    <main class="py-12 px-6 flex-grow">
        <div class="max-w-7xl mx-auto">
            <h1 class="text-3xl font-bold text-center mb-6 text-primary-blue">Daftar Administrator</h1>

            <div class="flex flex-wrap gap-4 justify-center mb-8">
                <button id="openModalBtn" class="neumo-btn inline-flex items-center justify-center px-6 py-3 text-base font-semibold rounded-xl text-primary-blue hover:text-white hover:bg-primary-blue active:shadow-neumo-press transition duration-300">
                    Tambah Administrator <i data-lucide="plus" class="w-4 h-4 ml-2"></i>
                </button>
                <button class="neumo-btn inline-flex items-center justify-center px-6 py-3 text-base font-semibold rounded-xl text-primary-blue hover:text-white hover:bg-primary-blue active:shadow-neumo-press transition duration-300">
                    Export <i data-lucide="download" class="w-4 h-4 ml-2"></i>
                </button>
                <a href="index.html" class="neumo-btn inline-flex items-center justify-center px-6 py-3 text-base font-semibold rounded-xl text-primary-blue hover:text-white hover:bg-primary-blue active:shadow-neumo-press transition duration-300">
                    Beranda <i data-lucide="home" class="w-4 h-4 ml-2"></i>
                </a>
            </div>

            <div class="admin-table">
                <table class="table table-hover w-full">
                    <thead>
                        <tr>
                            <th>No</th>
                            <th>Nama Admin</th>
                            <th>NIP</th>
                            <th>Password</th>
                            <th>Photo Image</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="adminTableBody">
                        </tbody>
                </table>
            </div>
        </div>
    </main>

    <div class="modal fade" id="adminModal" tabindex="-1" aria-labelledby="adminModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="adminModalLabel">Tambah Administrator Baru</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <img src="https://via.placeholder.com/120x180?text=Photo+Admin" id="photoPreview" alt="Portrait Image" class="portrait-photo">
                <form id="adminForm">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="namaAdmin" class="form-label">Nama Admin</label>
                            <input type="text" class="form-control" id="namaAdmin" required>
                        </div>
                        <div class="mb-3">
                            <label for="nipAdmin" class="form-label">NIP</label>
                            <input type="text" class="form-control" id="nipAdmin" required>
                        </div>
                        <div class="mb-3">
                            <label for="passwordAdmin" class="form-label">Password</label>
                            <input type="password" class="form-control" id="passwordAdmin" required>
                        </div>
                        <div class="mb-3">
                            <label for="photoAdmin" class="form-label">Upload Photo</label>
                            <input type="file" class="form-control" id="photoAdmin" accept="image/*" required>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary neumo-btn">Konfirmasi</button> 
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="detailModal" tabindex="-1" aria-labelledby="detailModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="detailModalLabel">Edit Administrator</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="detailForm">
                    <div class="modal-body">
                        <img id="detailPortrait" src="" alt="Portrait Image" class="portrait-photo">
                        <div class="mb-3">
                            <label for="detailNama" class="form-label">Nama Admin</label>
                            <input type="text" class="form-control" id="detailNama" required>
                        </div>
                        <div class="mb-3">
                            <label for="detailNip" class="form-label">NIP</label>
                            <input type="text" class="form-control" id="detailNip" required>
                        </div>
                        <div class="mb-3">
                            <label for="detailPassword" class="form-label">Password</label>
                            <input type="password" class="form-control" id="detailPassword" required>
                        </div>
                        <div class="mb-3">
                            <label for="detailPhoto" class="form-label">Upload Photo Baru (Opsional)</label>
                            <input type="file" class="form-control" id="detailPhoto" accept="image/*">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" id="deleteBtn">Delete</button>
                        <button type="submit" class="btn btn-primary neumo-btn">Update</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

 <!-- Footer -->
    <footer class="bg-gray-800 text-white pt-12 pb-8" id="kontak">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 gap-8 md:grid-cols-3">
                <div>
                    <h4 class="text-xl font-semibold mb-4 text-blue-400">PTSP Kementerian Agama Bangka Barat</h4>
                    <p class="text-sm mb-2 flex items-start">
                        <i data-lucide="map-pin" class="w-5 h-5 mr-3 flex-shrink-0"></i>
                        Komplek Perkantoran Terpadu Pemkab Bangka Barat, Daya Baru Pal 4, Mentok. Kode Pos: 33351
                    </p>
                    <p class="text-sm mb-2 flex items-start">
                        <i data-lucide="mail" class="w-5 h-5 mr-3 flex-shrink-0"></i>
                        kemenagkabbabar@gmail.com
                    </p>
                    <p class="text-sm flex items-start">
                        <i data-lucide="phone" class="w-5 h-5 mr-3 flex-shrink-0"></i>
                        (0717)1234567
                    </p>
                </div>
                <div>
                    <h4 class="text-xl font-semibold mb-4 text-blue-400">Link Cepat</h4>
                    <ul class="space-y-2 text-sm">
                        <li><a href="#layanan" class="hover:text-blue-300 transition duration-150">Daftar Layanan</a></li>
                        <li><a href="prosedur.html" class="hover:text-blue-300 transition duration-150">Standar Pelayanan</a></li>
                        <li><a href="#faq" class="hover:text-blue-300 transition duration-150">FAQ</a></li>
                    </ul>
                </div>
                <div class="md:text-right">
                    <h4 class="text-xl font-semibold mb-4 text-blue-400">Ikuti Kami</h4>
                    <div class="flex space-x-4 md:justify-end">
                        <div class="w-10 h-10 rounded-full bg-gray-700 shadow-lg flex items-center justify-center transition duration-300 hover:bg-blue-500">
                            <i data-lucide="facebook" class="w-5 h-5 text-white"></i>
                        </div>
                        <div class="w-10 h-10 rounded-full bg-gray-700 shadow-lg flex items-center justify-center transition duration-300 hover:bg-blue-500">
                            <i data-lucide="twitter" class="w-5 h-5 text-white"></i>
                        </div>
                        <div class="w-10 h-10 rounded-full bg-gray-700 shadow-lg flex items-center justify-center transition duration-300 hover:bg-blue-500">
                            <i data-lucide="instagram" class="w-5 h-5 text-white"></i>
                        </div>
                        <div class="w-10 h-10 rounded-full bg-gray-700 shadow-lg flex items-center justify-center transition duration-300 hover:bg-blue-500">
                            <i data-lucide="user-cog" class="w-5 h-5 text-white"></i>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-8 pt-6 border-t border-gray-700 text-center">
                <p class="text-sm text-gray-400">© <span id="year"></span> PTSP Digital. Hak Cipta Dilindungi.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Sidebar
        const menuButton = document.getElementById('menu-button');
        const closeMenuButton = document.getElementById('close-menu-button');
        const sidebarMenu = document.getElementById('sidebar-menu');
        const overlay = document.getElementById('overlay');
        const body = document.body;

        function openMenu() {
            sidebarMenu.classList.add('open');
            overlay.classList.remove('opacity-0', 'pointer-events-none');
            overlay.classList.add('opacity-50', 'pointer-events-auto');
            body.style.overflow = 'hidden';
        }

        function closeMenu() {
            sidebarMenu.classList.remove('open');
            overlay.classList.remove('opacity-50', 'pointer-events-auto');
            overlay.classList.add('opacity-0', 'pointer-events-none');
            body.style.overflow = '';
        }

        menuButton.addEventListener('click', openMenu);
        closeMenuButton.addEventListener('click', closeMenu);
        overlay.addEventListener('click', closeMenu);

        // Lucide
        lucide.createIcons();

        // Year
        document.getElementById('year').textContent = new Date().getFullYear();

        // Smooth Scroll 
        document.querySelectorAll('#sidebar-menu a[href^="#"]').forEach(item => {
            item.addEventListener('click', (e) => {
                const targetId = item.getAttribute('href');
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    e.preventDefault(); 
                    window.scrollTo({
                        top: targetElement.offsetTop - 64,
                        behavior: 'smooth'
                    });
                }
                closeMenu();
            });
        });

        // =======================================================
        // >>>>>>> PERBAIKAN INISIALISASI SUPABASE CLIENT <<<<<<<<
        // =======================================================
        const SUPABASE_URL = 'https://ridspgzuzptmckeznpkt.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJpZHNwZ3p1enB0bWNrZXpucGt0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwMTk4MzEsImV4cCI6MjA3ODU5NTgzMX0.va-HJexum-IFKP8aTA4LBvQb6vcUdNseBXfnElFL5oE';
        
        // Menggunakan window.supabase yang disediakan oleh CDN
        const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        // =======================================================


        // Fungsi untuk mengambil dan merender data administrator
        async function fetchAdmins() {
            const tableBody = document.getElementById('adminTableBody');
            tableBody.innerHTML = ''; 
            
            const { data: admins, error } = await supabaseClient // Menggunakan supabaseClient yang benar
                .from('tabeladmin')
                .select('*')
                .order('id', { ascending: true });

            if (error) {
                console.error('Error fetching admins:', error.message);
                tableBody.innerHTML = `<tr><td colspan="6" class="text-center text-red-500">Gagal memuat data: ${error.message}</td></tr>`;
                return;
            }

            if (admins && admins.length > 0) {
                admins.forEach((admin, index) => {
                    const row = tableBody.insertRow();
                    row.dataset.adminId = admin.id;
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${admin.nama}</td>
                        <td>${admin.nip}</td>
                        <td>******</td> <td><img src="${admin.photo}" alt="Foto ${admin.nama}" class="admin-photo mx-auto"></td>
                        <td>
                            <button class="btn-3d-aksi btn-aksi p-2 text-sm">
                                <i data-lucide="edit" class="w-4 h-4"></i>
                            </button>
                        </td>
                    `;
                });
                lucide.createIcons();
            } else {
                 tableBody.innerHTML = `<tr><td colspan="6" class="text-center text-gray-500">Tidak ada data administrator.</td></tr>`;
            }
        }

        // Panggil saat halaman dimuat
        document.addEventListener('DOMContentLoaded', fetchAdmins);


        // Modal Tambah Administrator
        const openModalBtn = document.getElementById('openModalBtn');
        const adminModal = new bootstrap.Modal(document.getElementById('adminModal'));
        const adminForm = document.getElementById('adminForm');

        // Event listener ini seharusnya sudah berfungsi setelah perbaikan inisialisasi Supabase
        openModalBtn.addEventListener('click', () => {
            adminForm.reset(); 
            // Reset gambar ke placeholder saat modal dibuka
            document.getElementById('photoPreview').src = "https://via.placeholder.com/120x180?text=Photo+Admin"; 
            adminModal.show();
        });

        adminForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const submitButton = e.target.querySelector('button[type="submit"]');
            submitButton.disabled = true;
            submitButton.textContent = 'Menyimpan...';

            const nama = document.getElementById('namaAdmin').value;
            const nip = document.getElementById('nipAdmin').value;
            const password = document.getElementById('passwordAdmin').value;
            const photo = document.getElementById('photoAdmin').files[0];
            const BUCKET_NAME = 'aset_pelite'; 

            if (nama && nip && password && photo) {
                try {
                    // 1. Upload file foto ke Supabase Storage (menggunakan supabaseClient)
                    const filePath = `admins/${nip}/${Date.now()}-${photo.name}`;
                    const { data: uploadData, error: uploadError } = await supabaseClient 
                        .storage
                        .from(BUCKET_NAME)
                        .upload(filePath, photo);

                    if (uploadError) throw uploadError;

                    // 2. Dapatkan URL publik (menggunakan supabaseClient)
                    const { data: urlData } = supabaseClient
                        .storage
                        .from(BUCKET_NAME)
                        .getPublicUrl(filePath);

                    if (!urlData || !urlData.publicUrl) throw new Error("Gagal mendapatkan URL publik.");

                    // 3. Simpan semua data ke tabel 'tabeladmin' (menggunakan supabaseClient)
                    const { error: insertError } = await supabaseClient 
                        .from('tabeladmin')
                        .insert([{ nama, nip, password, photo: urlData.publicUrl }]);

                    if (insertError) throw insertError;

                    alert('Administrator baru berhasil ditambahkan!');
                    adminModal.hide();
                    fetchAdmins(); 

                } catch (error) {
                    console.error('Error:', error.message);
                    alert(`Gagal menambahkan administrator: ${error.message}`);
                } finally {
                    submitButton.disabled = false;
                    submitButton.textContent = 'Konfirmasi';
                }
            } else {
                alert('Mohon lengkapi semua field!');
                submitButton.disabled = false;
                submitButton.textContent = 'Konfirmasi';
            }
        });

        // Modal Detail/Edit Administrator
        const detailModal = new bootstrap.Modal(document.getElementById('detailModal'));
        const detailForm = document.getElementById('detailForm');
        const detailPortrait = document.getElementById('detailPortrait');
        const deleteBtn = document.getElementById('deleteBtn');

        // Event delegation untuk tombol "Aksi" (Detail/Edit)
        document.addEventListener('click', async (e) => {
            if (e.target.closest('.btn-aksi')) {
                const row = e.target.closest('tr');
                const adminId = parseInt(row.dataset.adminId);

                // Ambil data terbaru dari Supabase (menggunakan supabaseClient)
                const { data: admin, error } = await supabaseClient 
                    .from('tabeladmin')
                    .select('*')
                    .eq('id', adminId)
                    .single();

                if (error) {
                    return alert('Gagal mengambil detail admin: ' + error.message);
                }

                if (admin) {
                    document.getElementById('detailModalLabel').textContent = `Edit Administrator - ${admin.nama}`;
                    document.getElementById('detailNama').value = admin.nama;
                    document.getElementById('detailNip').value = admin.nip;
                    document.getElementById('detailPassword').value = admin.password;
                    detailPortrait.src = admin.photo;

                    let hiddenId = detailForm.querySelector('input[name="adminId"]');
                    if (!hiddenId) {
                        hiddenId = document.createElement('input');
                        hiddenId.type = 'hidden';
                        hiddenId.name = 'adminId';
                        detailForm.appendChild(hiddenId);
                    }
                    hiddenId.value = admin.id;

                    detailModal.show();
                }
            }
        });

        // UPDATE Logic
        detailForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const submitButton = e.target.querySelector('button[type="submit"]');
            submitButton.disabled = true;
            submitButton.textContent = 'Memperbarui...';

            const adminId = parseInt(detailForm.querySelector('input[name="adminId"]').value);
            const nama = document.getElementById('detailNama').value;
            const nip = document.getElementById('detailNip').value;
            const password = document.getElementById('detailPassword').value;
            const newPhotoFile = document.getElementById('detailPhoto').files[0];
            const BUCKET_NAME = 'aset_pelite';
            let photoUrl = detailPortrait.src; 

            try {
                // 1. Upload foto baru jika ada (menggunakan supabaseClient)
                if (newPhotoFile) {
                    const filePath = `admins/${nip}/${Date.now()}-${newPhotoFile.name}`;
                    const { data: uploadData, error: uploadError } = await supabaseClient
                        .storage
                        .from(BUCKET_NAME)
                        .upload(filePath, newPhotoFile);

                    if (uploadError) throw uploadError;

                    const { data: urlData } = supabaseClient
                        .storage
                        .from(BUCKET_NAME)
                        .getPublicUrl(filePath);
                    
                    if (urlData && urlData.publicUrl) {
                        photoUrl = urlData.publicUrl;
                    }
                }

                // 2. Update data di tabel 'tabeladmin' (menggunakan supabaseClient)
                const { error: updateError } = await supabaseClient
                    .from('tabeladmin')
                    .update({ nama, nip, password, photo: photoUrl })
                    .eq('id', adminId);

                if (updateError) throw updateError;

                alert('Administrator berhasil diperbarui!');
                detailModal.hide();
                fetchAdmins();

            } catch (error) {
                console.error('Error updating admin:', error.message);
                alert(`Gagal memperbarui administrator: ${error.message}`);
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = 'Update';
            }
        });

        // DELETE Logic
        deleteBtn.addEventListener('click', async () => {
            const adminId = parseInt(detailForm.querySelector('input[name="adminId"]').value);
            const adminNama = document.getElementById('detailNama').value;

            if (confirm(`Apakah Anda yakin ingin menghapus administrator ${adminNama} ini? Tindakan ini tidak dapat dibatalkan.`)) {
                try {
                    // Lakukan penghapusan di Supabase (menggunakan supabaseClient)
                    const { error: deleteError } = await supabaseClient
                        .from('tabeladmin')
                        .delete()
                        .eq('id', adminId);

                    if (deleteError) throw deleteError;

                    alert('Administrator berhasil dihapus.');
                    detailModal.hide();
                    fetchAdmins();

                } catch (error) {
                    console.error('Error deleting admin:', error.message);
                    alert(`Gagal menghapus administrator: ${error.message}`);
                }
            }
        });

        // Preview Photo on File Select (Modal Tambah)
        const photoAdminInput = document.getElementById('photoAdmin');
        const photoPreview = document.getElementById('photoPreview'); 

        photoAdminInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    if (photoPreview) {
                        photoPreview.src = e.target.result;
                    }
                }
                reader.readAsDataURL(file);
            }
        });
    </script>
</body>
</html>
